{
  "meta": {
    "context_schema_version": "1.1",
    "generator": "scripts/ai-context.js",
    "generated_at": "2026-01-03T05:06:53.711Z",
    "repo_root": "C:\\data\\@apifactory\\oas3-modularize",
    "profile": "debug",
    "flags": {
      "include_git": true,
      "include_quality_details": true,
      "maxLines": 2000,
      "maxTreeLines": 1200
    }
  },
  "declared": {
    "product": {
      "source": "declared",
      "confidence": "high",
      "value": {
        "name": "OpenAPI Builder",
        "type": "node-cli",
        "purpose": "CLI para modularizar contratos OpenAPI 3.x, generar bundle, docs Markdown y convertir a Swagger 2.0, siguiendo Clean Architecture (capas, puertos/adaptadores).\n",
        "audience": [
          "API teams",
          "platform engineering",
          "backend engineers"
        ],
        "expected_outputs": [
          {
            "path": "./src",
            "description": "Estructura modular generada desde un OpenAPI monolítico",
            "guaranteed_after_success": true,
            "idempotent": "yes (if clean output enabled)",
            "must_exist_before": false
          },
          {
            "path": "./dist/bundle.yaml",
            "description": "Bundle OpenAPI 3 consolidado",
            "guaranteed_after_success": true,
            "idempotent": "yes",
            "must_exist_before": false
          },
          {
            "path": "./docs/api.md",
            "description": "Documentación Markdown generada",
            "guaranteed_after_success": true,
            "idempotent": "yes",
            "must_exist_before": false
          },
          {
            "path": "./dist/swagger2.yaml",
            "description": "Conversión a Swagger 2.0",
            "guaranteed_after_success": true,
            "idempotent": "yes",
            "must_exist_before": false
          }
        ]
      }
    },
    "authoritative_intent": {
      "source": "declared",
      "confidence": "high",
      "value": "Este repo implementa un CLI orientado a “API contract operations”: convertir una spec OpenAPI 3.x monolítica en estructura modular mantenible, consolidar a bundle validado, generar documentación y exportar a Swagger 2.0 para compatibilidad legacy.\n"
    },
    "operational_model": {
      "source": "declared",
      "confidence": "high",
      "value": {
        "declared_inputs": [
          {
            "name": "openapi_spec",
            "type": "file",
            "formats": [
              "yaml",
              "yml",
              "json"
            ],
            "required": true,
            "used_by": [
              "modularize"
            ],
            "examples": [
              "./api/openapi.yaml"
            ]
          },
          {
            "name": "modular_entrypoint",
            "type": "file",
            "formats": [
              "yaml",
              "yml"
            ],
            "required": false,
            "used_by": [
              "bundle"
            ],
            "default": "./src/main.yaml"
          },
          {
            "name": "bundle_input",
            "type": "file",
            "formats": [
              "yaml",
              "yml"
            ],
            "required": false,
            "used_by": [
              "docs",
              "swagger2"
            ],
            "default": "./dist/bundle.yaml"
          },
          {
            "name": "configs",
            "type": "folder",
            "required": false,
            "files": [
              "./config/modularize.yaml",
              "./config/bundle.yaml",
              "./config/swagger2.yaml",
              "./config/logging.yaml"
            ]
          }
        ],
        "invariants": [
          "No modifica el OpenAPI original de entrada; toda salida va a ./src ./dist ./docs.",
          "Paths relativos se resuelven contra el cwd (directorio donde se ejecuta el CLI).",
          "Arquitectura: domain no debe importar infrastructure; interface orquesta use-cases."
        ]
      }
    },
    "operations": {
      "source": "declared",
      "confidence": "high",
      "value": {
        "commands": [
          {
            "name": "modularize",
            "summary": "Divide un OpenAPI monolítico en estructura modular con fix de refs y deduplicación.",
            "inputs": [
              {
                "flag": "--build",
                "meaning": "Archivo OpenAPI monolítico (yaml/json)",
                "required": true
              }
            ],
            "outputs": [
              {
                "path": "./src",
                "guaranteed_after_success": true
              }
            ]
          },
          {
            "name": "bundle",
            "summary": "Consolida estructura modular en bundle OpenAPI 3 (opcionalmente remove-unused, validate, no-anchors).",
            "inputs": [
              {
                "flag": "-i/--input",
                "meaning": "Entrypoint modular",
                "required": false,
                "default": "./src/main.yaml"
              },
              {
                "flag": "-o/--output",
                "meaning": "Ruta del bundle",
                "required": false,
                "default": "./dist/bundle.yaml"
              }
            ],
            "outputs": [
              {
                "path": "./dist/bundle.yaml",
                "guaranteed_after_success": true
              }
            ]
          },
          {
            "name": "docs",
            "summary": "Genera documentación Markdown desde el bundle.",
            "inputs": [
              {
                "flag": "-i/--input",
                "meaning": "Bundle OpenAPI",
                "required": false,
                "default": "./dist/bundle.yaml"
              },
              {
                "flag": "-o/--output",
                "meaning": "Ruta Markdown",
                "required": false,
                "default": "./docs/api.md"
              }
            ],
            "outputs": [
              {
                "path": "./docs/api.md",
                "guaranteed_after_success": true
              }
            ]
          },
          {
            "name": "swagger2",
            "summary": "Convierte OpenAPI 3.x a Swagger 2.0.",
            "inputs": [
              {
                "flag": "-i/--input",
                "meaning": "Bundle OpenAPI 3",
                "required": false,
                "default": "./dist/bundle.yaml"
              },
              {
                "flag": "-o/--output",
                "meaning": "Ruta Swagger 2",
                "required": false,
                "default": "./dist/swagger2.yaml"
              }
            ],
            "outputs": [
              {
                "path": "./dist/swagger2.yaml",
                "guaranteed_after_success": true
              }
            ]
          }
        ]
      }
    },
    "ai_contract": {
      "source": "declared",
      "confidence": "high",
      "value": {
        "assumptions": [
          "CLI ejecutado en Node >= 16",
          "Herramientas externas pueden usarse (ej: redocly, widdershins) vía dependencias"
        ],
        "non_goals": [
          "No modificar OpenAPI original",
          "No soportar OpenAPI 3.1 aún"
        ],
        "constraints": [
          "Domain layer must not import infrastructure layer.",
          "CLI flags are the primary public API; evitar romper compatibilidad."
        ],
        "known_ambiguities": [
          "Extracción de comandos desde código puede ser heurística si no está declarada aquí.",
          "El manifest puede quedar desincronizado si se agregan flags sin actualizarlo."
        ]
      }
    },
    "inputs_outputs": {
      "source": "declared",
      "confidence": "high",
      "value": {
        "inputs": [
          {
            "kind": "config",
            "path": "./config/modularize.yaml",
            "required": false,
            "source": "declared"
          },
          {
            "kind": "config",
            "path": "./config/bundle.yaml",
            "required": false,
            "source": "declared"
          },
          {
            "kind": "config",
            "path": "./config/swagger2.yaml",
            "required": false,
            "source": "declared"
          },
          {
            "kind": "config",
            "path": "./config/logging.yaml",
            "required": false,
            "source": "declared"
          },
          {
            "kind": "manifest",
            "path": "./ai/manifest.yml",
            "required": false,
            "source": "declared"
          },
          {
            "kind": "openapi_spec",
            "path": "(varies: --build)",
            "required": true,
            "source": "declared"
          }
        ],
        "outputs": [
          {
            "path": "./src",
            "description": "Estructura modular generada desde un OpenAPI monolítico",
            "guaranteed_after_success": true,
            "must_exist_before": false,
            "idempotent": "yes (if clean output enabled)",
            "source": "declared"
          },
          {
            "path": "./dist/bundle.yaml",
            "description": "Bundle OpenAPI 3 consolidado",
            "guaranteed_after_success": true,
            "must_exist_before": false,
            "idempotent": "yes",
            "source": "declared"
          },
          {
            "path": "./docs/api.md",
            "description": "Documentación Markdown generada",
            "guaranteed_after_success": true,
            "must_exist_before": false,
            "idempotent": "yes",
            "source": "declared"
          },
          {
            "path": "./dist/swagger2.yaml",
            "description": "Conversión a Swagger 2.0",
            "guaranteed_after_success": true,
            "must_exist_before": false,
            "idempotent": "yes",
            "source": "declared"
          }
        ]
      }
    },
    "known_ambiguities": {
      "source": "declared",
      "confidence": "high",
      "value": [
        "Extracción de comandos desde código puede ser heurística si no está declarada aquí.",
        "El manifest puede quedar desincronizado si se agregan flags sin actualizarlo."
      ]
    }
  },
  "inferred": {
    "product": {
      "source": "inferred",
      "confidence": "medium",
      "value": {
        "name": "OpenAPI Builder",
        "type": "node-cli",
        "purpose": "CLI para modularizar contratos OpenAPI 3.x, generar bundle, docs Markdown y convertir a Swagger 2.0, siguiendo Clean Architecture (capas, puertos/adaptadores).\n"
      }
    },
    "commands_detected": {
      "source": "inferred",
      "confidence": "medium",
      "value": [
        "modularize",
        "bundle",
        "docs",
        "swagger2"
      ]
    }
  },
  "measured": {
    "architecture": {
      "source": "measured",
      "confidence": "high",
      "value": {
        "layers": [
          {
            "layer": "interface",
            "path": "bin/interface"
          },
          {
            "layer": "application",
            "path": "bin/application"
          },
          {
            "layer": "domain",
            "path": "bin/domain"
          },
          {
            "layer": "infrastructure",
            "path": "bin/infrastructure"
          }
        ],
        "ports": "bin/application/ports",
        "adapters": "bin/infrastructure/adapters"
      }
    },
    "quality": {
      "source": "measured",
      "confidence": "high",
      "value": {
        "knip": {
          "status": "fail",
          "reason": "2 issue(s) detected",
          "summary": "2 issue(s) detected",
          "issueCount": 2,
          "issues": [
            {
              "file": "bin/main.js",
              "message": "Remove redundant entry pattern"
            },
            {
              "file": "knip.json",
              "message": "Remove redundant entry pattern"
            }
          ],
          "details_truncated": false,
          "details": {
            "code": 1,
            "parsedIssues": [
              {
                "file": "bin/main.js",
                "message": "Remove redundant entry pattern"
              },
              {
                "file": "knip.json",
                "message": "Remove redundant entry pattern"
              }
            ],
            "err": "bin/main.js    knip.json  Remove redundant entry pattern",
            "out": "Unused dependencies (4)\n@redocly/cli        package.json:45:6\napi-spec-converter  package.json:46:6\ninquirer            package.json:49:6\nwiddershins         package.json:51:6\nUnused devDependencies (2)\ndependency-cruiser  package.json:55:6\nmadge               package.json:59:6\nConfiguration hints (1)"
          },
          "source": "measured"
        },
        "dependencyCruiser": {
          "status": "pass",
          "reason": "no violations",
          "summary": "clean",
          "details_truncated": false,
          "details": "✔ no dependency violations found (51 modules, 66 dependencies cruised)",
          "source": "measured"
        }
      }
    },
    "git": {
      "source": "measured",
      "confidence": "high",
      "value": {
        "source": "measured",
        "included": true,
        "branch": "main",
        "lastCommit": "5929ef2 feat: implement hexagonal architecture",
        "dirty": true,
        "modified_count": 7,
        "untracked_count": 1,
        "statusSummary": "7 modified, 1 untracked",
        "details": "M ai/context.json\n M ai/context.md\n M bin/domain/entities/ComponentFile.js\n M bin/domain/services/ComponentSplitterService.js\n M bin/domain/services/ParameterExtractorService.js\n M config/modularize.yaml\n M scripts/ai-context.js\n?? tests/unit/domain/services/ParameterExtractorService.test.js"
      }
    }
  },
  "execution_narrative": {
    "source": "inferred",
    "confidence": "medium",
    "value": "When running openapi-builder modularize:\n- CLI parses flags and resolves cwd-relative paths.\n- Modularize use-case validates the input OpenAPI 3.x.\n- Domain services normalize response names, extract inline responses, deduplicate, split components and paths.\n- Writes a modular structure under ./src (main.yaml + components/ + paths/), fixing $ref as needed.\n\nWhen running openapi-builder bundle:\n- Takes modular entrypoint (default ./src/main.yaml).\n- Bundles into a single OpenAPI file (default ./dist/bundle.yaml), optionally removing unused components and validating.\n\nWhen running openapi-builder docs:\n- Uses the bundle as input (default ./dist/bundle.yaml) and generates Markdown docs (default ./docs/api.md).\n\nWhen running openapi-builder swagger2:\n- Converts bundle OpenAPI 3.x to Swagger 2.0 output (default ./dist/swagger2.yaml)."
  },
  "inventory": {
    "source": "measured",
    "confidence": "high",
    "value": [
      {
        "path": "bin/main.js",
        "type": "file",
        "depth": 0
      },
      {
        "path": "bin/interface/cli/",
        "type": "dir",
        "depth": 0
      },
      {
        "path": "bin/interface/cli/cli.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/interface/cli/CommandFactory.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/interface/cli/DependencyContainer.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/interface/menu/",
        "type": "dir",
        "depth": 0
      },
      {
        "path": "bin/interface/presenters/",
        "type": "dir",
        "depth": 0
      },
      {
        "path": "bin/application/ports/",
        "type": "dir",
        "depth": 0
      },
      {
        "path": "bin/application/ports/IBundler.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/application/ports/IDocGenerator.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/application/ports/IDocumentRepository.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/application/ports/ILogger.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/application/ports/IPrompter.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/application/ports/IValidator.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/application/use-cases/",
        "type": "dir",
        "depth": 0
      },
      {
        "path": "bin/application/use-cases/BundleUseCase.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/application/use-cases/DowngradeSwagger2UseCase.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/application/use-cases/GenerateDocsUseCase.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/application/use-cases/ModularizeUseCase.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/entities/",
        "type": "dir",
        "depth": 0
      },
      {
        "path": "bin/domain/entities/Component.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/entities/ComponentFile.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/entities/ModularizationModel.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/entities/OpenAPIDocument.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/entities/PathFile.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/services/",
        "type": "dir",
        "depth": 0
      },
      {
        "path": "bin/domain/services/ComponentSplitterService.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/services/ModelValidator.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/services/ModularizationModelBuilder.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/services/NameNormalizerService.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/services/ParameterExtractorService.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/services/ReferenceFixerService.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/services/ReferenceResolver.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/services/ResponseDeduplicatorService.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/services/ResponseExtractorService.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/value-objects/",
        "type": "dir",
        "depth": 0
      },
      {
        "path": "bin/domain/value-objects/FilePath.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/domain/value-objects/StatusCode.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/infrastructure/adapters/",
        "type": "dir",
        "depth": 0
      },
      {
        "path": "bin/infrastructure/adapters/ApiSpecConverterDowngrader.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/infrastructure/adapters/InquirerPrompter.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/infrastructure/adapters/ModularizationWriter.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/infrastructure/adapters/RedoclyBundler.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/infrastructure/adapters/RedoclyValidator.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/infrastructure/adapters/WiddershinsDocGenerator.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/infrastructure/adapters/YamlDocumentRepository.js",
        "type": "file",
        "depth": 1
      },
      {
        "path": "bin/infrastructure/config/",
        "type": "dir",
        "depth": 0
      },
      {
        "path": "bin/infrastructure/logging/",
        "type": "dir",
        "depth": 0
      },
      {
        "path": "bin/infrastructure/utils/",
        "type": "dir",
        "depth": 0
      },
      {
        "path": "config/bundle.yaml",
        "type": "file",
        "depth": 0
      },
      {
        "path": "config/logging.yaml",
        "type": "file",
        "depth": 0
      },
      {
        "path": "config/modularize.yaml",
        "type": "file",
        "depth": 0
      },
      {
        "path": "config/swagger2.yaml",
        "type": "file",
        "depth": 0
      },
      {
        "path": "scripts/ai-context.js",
        "type": "file",
        "depth": 0
      },
      {
        "path": "ai/manifest.yml",
        "type": "file",
        "depth": 0
      },
      {
        "path": "package.json",
        "type": "file",
        "depth": 0
      },
      {
        "path": ".dependency-cruiser.js",
        "type": "file",
        "depth": 0
      }
    ],
    "truncated": true
  },
  "package": {
    "source": "measured",
    "confidence": "high",
    "value": {
      "name": "@apifactory/openapi-builder",
      "version": "1.0.1",
      "description": "CLI para trabajar con contratos OpenAPI 3: modularizar, generar bundle, documentación Markdown y convertir a Swagger 2.0.",
      "bin": {
        "openapi-builder": "bin/main.js"
      },
      "scripts": {
        "modularize": "node bin/main.js modularize",
        "bundle": "node bin/main.js bundle",
        "docs": "node bin/main.js docs",
        "swagger2": "node bin/main.js swagger2",
        "test": "jest",
        "test:watch": "jest --watch",
        "test:coverage": "jest --coverage",
        "test:integration": "jest tests/integration",
        "test:unit": "jest tests/unit",
        "test:ci": "jest --ci --coverage --maxWorkers=2"
      },
      "dependencies": {
        "@redocly/cli": "1.19.0",
        "api-spec-converter": "2.12.0",
        "chalk": "^4.1.2",
        "commander": "12.1.0",
        "inquirer": "8.2.6",
        "prompts": "^2.4.2",
        "widdershins": "4.0.1"
      },
      "devDependencies": {
        "@types/jest": "^30.0.0",
        "dependency-cruiser": "^17.3.5",
        "jest": "^30.2.0",
        "js-yaml": "^4.1.1",
        "knip": "^5.77.1",
        "madge": "^8.0.0"
      },
      "dependenciesTop": [
        "@redocly/cli",
        "api-spec-converter",
        "chalk",
        "commander",
        "inquirer",
        "prompts",
        "widdershins"
      ],
      "devDependenciesTop": [
        "@types/jest",
        "dependency-cruiser",
        "jest",
        "js-yaml",
        "knip",
        "madge"
      ]
    }
  }
}